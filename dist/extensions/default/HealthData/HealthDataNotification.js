define(function(require,exports,module){"use strict";var AppInit=brackets.getModule("utils/AppInit"),PreferencesManager=brackets.getModule("preferences/PreferencesManager"),Strings=brackets.getModule("strings"),Dialogs=brackets.getModule("widgets/Dialogs"),UrlParams=brackets.getModule("utils/UrlParams").UrlParams,HealthDataPreview=require("HealthDataPreview"),HealthDataManager=require("HealthDataManager"),HealthDataNotificationDialog=require("text!htmlContent/healthdata-notification-dialog.html");PreferencesManager.definePreference("healthDataNotificationShown","boolean",false);var prefs=PreferencesManager.getExtensionPrefs("healthData");var params=new UrlParams;function showDialogHealthDataNotification(){var hdPref=prefs.get("healthDataTracking"),template=Mustache.render(HealthDataNotificationDialog,{Strings:Strings,hdPref:hdPref}),$template=$(template),newHDPref=hdPref,result=new $.Deferred;Dialogs.showModalDialogUsingTemplate($template).done(function(id){PreferencesManager.setViewState("healthDataNotificationShown",true);if(id==="save"){newHDPref=$template.find("[data-target]:checkbox").is(":checked");if(hdPref!==newHDPref){prefs.set("healthDataTracking",newHDPref)}}result.resolve()});return result.promise()}function handleHealthDataStatistics(){var hdPref=prefs.get("healthDataTracking");if(hdPref){HealthDataPreview.previewHealthData()}else{showDialogHealthDataNotification()}}AppInit.appReady(function(){params.parse();if(!params.get("testEnvironment")){var isShown=PreferencesManager.getViewState("healthDataNotificationShown");if(!isShown){showDialogHealthDataNotification().done(function(){HealthDataManager.checkHealthDataSend()})}}});exports.showDialogHealthDataNotification=showDialogHealthDataNotification;exports.handleHealthDataStatistics=handleHealthDataStatistics});
define(function(require,exports,module){"use strict";var EditorManager=brackets.getModule("editor/EditorManager");var LiveDevProtocol=brackets.getModule("LiveDevelopment/MultiBrowserImpl/protocol/LiveDevProtocol");var MouseManagerRemote=require("text!lib/MouseManagerRemote.js");var _isEnabled=false;var _prev;function enable(){_isEnabled=true}function disable(){_isEnabled=false;clearHighlight()}function highlightElem(id){var selector="[data-brackets-id='"+id+"']";var script="_LD.highlightRule("+JSON.stringify(selector)+")";LiveDevProtocol.evaluate(script)}function getHighlightInfo(msg){var match=msg.match(/^bramble-highlight-lines\:([0-9]+),([0-9]+),([0-9]+),([0-9]+),?([0-9]+)?/);if(!(match&&match[1]&&match[2]&&match[3]&&match[4])){return}return{startLine:match[1]|0,startCh:match[2]|0,endLine:match[3]|0,endCh:match[4]|0,bracketsId:match[5]|0}}function isHighlightLineRequest(msg){return!!getHighlightInfo(msg)}function isClearHighlightRequest(msg){return msg.match("^bramble-clear-highlight$")}function clearHighlight(){if(!_prev){return}_prev.clear();_prev=null}function highlightLine(msg){if(!_isEnabled){return}var info=getHighlightInfo(msg);if(!info){return}var from={line:info.startLine,ch:info.startCh};var to={line:info.endLine,ch:info.endCh};var editor=EditorManager.getActiveEditor();if(!editor){return}var codeMirror=editor._codeMirror;if(_prev){clearHighlight()}if(info.bracketsId){highlightElem(info.bracketsId)}var halfViewPort=codeMirror.getScrollInfo().clientHeight/2;codeMirror.scrollIntoView({from:from,to:to},halfViewPort|0);_prev=codeMirror.markText(from,to,{className:"CodeMirror-matchingtag"})}function getRemoteScript(filename){filename=filename||"unknown";return"<script>window.___brambleFilename = '"+filename+"';</script>\n"+"<script>\n"+MouseManagerRemote+"</script>\n"}exports.enable=enable;exports.disable=disable;exports.getRemoteScript=getRemoteScript;exports.highlightLine=highlightLine;exports.isClearHighlightRequest=isClearHighlightRequest;exports.clearHighlight=clearHighlight;exports.isHighlightLineRequest=isHighlightLineRequest});